(function(){"use strict";function Openbibl(){}Openbibl.prototype.config={template_dir:"../../js/templates"};Openbibl.prototype.debug=false;Openbibl.prototype.console=typeof console=="object"?console:{};Openbibl.prototype.bibliographies={count:0};Openbibl.prototype.event={target:null,events:{"obp:filter-start":"obp:filter-start","obp:filter-change":"obp:filter-change","obp:filter-mode-change":"obp:filter-mode-change","obp:filter-complete":"obp:filter-complete","obp:bibliography-added":"obp:bibliography-added","obp:search-term-change":"obp:search-term-change","obp:browse-term-change":"obp:browse-term-change"}};Openbibl.prototype.onDocumentReady=function(){this.event.target=$(document.getElementsByTagName("body")[0]);this.filter.init([this.search,this.browse]);this.highlight.init([this.search,this.browse]);this.search.init();this.browse.init();this.sort.init();this.change_theme(this.retrieve_cookie("theme-stylesheet"));var browse_data_file="query.json";var search_file=document.location.href.replace(/[^\/]+$/,"")+browse_data_file;this.query.init(search_file,[this.search,this.browse]);$(".obp-sort-anchor").on("click",function(e){window.obp.sort.sort_entries(e.target.getAttribute("data-sort-key"))});$(".obp-filter-mode").change(function(event){window.obp.search.filter_mode_change(event);window.obp.browse.filter_mode_change(event);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"])});window.obp.event["target"].on(obp.event["events"]["obp:bibliography-added"],function(){$('[data-toggle="tooltip"]').tooltip({placement:"top",trigger:"hover"})});window.obp.event["target"].on(obp.event["events"]["obp:filter-complete"],function(){$('[data-toggle="tooltip"]').tooltip({placement:"top",trigger:"hover"})});$(window).resize(function(){window.obp.event["target"].trigger(obp.event["events"]["obp:filter-mode-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:search-term-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:browse-term-change"])})};Openbibl.prototype.browse={};Openbibl.prototype.filter={};Openbibl.prototype.highlight={};Openbibl.prototype.query={};Openbibl.prototype.SaxonCE={};Openbibl.prototype.search={};Openbibl.prototype.sort={};Openbibl.prototype.storage={};Openbibl.prototype.typeahead={};window.obp=new Openbibl;$(document).ready(function(){window.obp.onDocumentReady()})})();(function(){"use strict";window.obp.browse.init=function(){$(".obp-browse-checkbox").click(function(event){var $list=$(event.target).closest(".obp-browse-list");var item={term:event.target.getAttribute("data-browse-item"),list:$list.attr("data-ed-list"),mode:$list.find(".obp-filter-mode:checked").val()};if(event.target.checked===true){window.obp.browse.model.add_term(item)}else{window.obp.browse.model.remove_term(item)}});$(".obp-browse-clear").click(function(event){var $list=$(event.target).closest(".obp-browse-list");var list_type=$list.attr("data-ed-list");var list_mode=$list.find(".obp-filter-mode:checked").val();window.obp.browse.model.remove_term({list:list_type,mode:list_mode});$list.find(".obp-browse-checkbox:checked").each(function(i,elt){elt.checked=false});event.preventDefault()});window.obp.event["target"].on(obp.event["events"]["obp:browse-term-change"],function(){window.obp.browse.view.browse_term_change()})};window.obp.browse.filter_indices=function(){return this.model.filter_indices()};window.obp.browse.highlight_items=function(){return this.model.highlight_items()};window.obp.browse.handle_query_data=function(data){this.model.handle_query_data(data)};window.obp.browse.filter_mode_change=function(event){window.obp.browse.model.filter_mode_change(event)};window.obp.browse.view={};window.obp.browse.view.browse_term_change=function(){var browse=window.obp.browse;$(".obp-browse-checkbox").map(function(i,elt){elt.checked=false});for(var i=0;i<browse.model.browse_lists.length;i++){var list=browse.model.browse_lists[i]["list"];var terms=browse.model.browse_lists[i]["terms"]||[];for(var j=0;j<terms.length;j++){$('.obp-browse-checkbox[data-browse-item="'+terms[j]+'"]').each(function(i,elt){elt.checked=true})}}};window.obp.browse.model={};window.obp.browse.model.browse_data=null;window.obp.browse.model.browse_lists=[];window.obp.browse.model.handle_query_data=function(data){window.obp.browse.model.browse_data=data["browse"]};window.obp.browse.model.filter_mode_change=function(event){var model=this;var $this=$(event.target);var list_type=$this.closest(".obp-browse-list").attr("data-ed-list");if(list_type!==undefined){var browse_mode=$this.val();for(var i=0;i<model.browse_lists.length;i++){if(model.browse_lists[i]["list"]===list_type){model.browse_lists[i]["mode"]=browse_mode}}}};window.obp.browse.model.add_term=function(item){var list=item["list"];var term=item["term"];var browse_obj;for(var i=0;i<this.browse_lists.length;i++){if(this.browse_lists[i]["list"]===list){browse_obj=this.browse_lists.splice(i,1)[0];break}}if(browse_obj===undefined){browse_obj={terms:[],list:list}}var current_terms=browse_obj["terms"]||[];if(_.indexOf(current_terms,term)!==-1)return;current_terms.push(term);browse_obj["terms"]=current_terms;browse_obj["mode"]=$('.obp-browse-list[data-ed-list="'+list+'"]').find(".obp-filter-mode:checked").val();this.browse_lists.push(browse_obj);window.obp.event["target"].trigger(obp.event["events"]["obp:browse-term-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"])};window.obp.browse.model.remove_term=function(item){var list=item["list"];var term=item["term"];var mode=item["mode"];var browse_obj;for(var i=0;i<this.browse_lists.length;i++){if(this.browse_lists[i]["list"]===list){browse_obj=this.browse_lists.splice(i,1)[0];break}}if(browse_obj===undefined||term===undefined){browse_obj={terms:[],list:list,mode:mode}}if(term!==undefined){var current_terms=browse_obj["terms"]||[];browse_obj["terms"]=_.difference(_.toArray(current_terms),term);browse_obj["mode"]=mode}this.browse_lists.push(browse_obj);window.obp.event["target"].trigger(obp.event["events"]["obp:browse-term-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"])};window.obp.browse.model.filter_indices=function(){var filter=window.obp.filter;var result_indices=filter.all_filter_indices();var browse_data=this.browse_data;for(var i=0;i<this.browse_lists.length;i++){var list_type=this.browse_lists[i]["list"];var mode=this.browse_lists[i]["mode"];var checked_items=this.browse_lists[i]["terms"];var list_indices;if(checked_items.length>0){for(var i=0;i<checked_items.length;i++){var item_id=checked_items[i];var item_indices=browse_data[list_type][item_id];list_indices=list_indices||item_indices;if(mode===filter.filter_mode_union){list_indices=_.union(list_indices,item_indices)}else{list_indices=_.intersection(list_indices,item_indices)}}list_indices=list_indices||[];result_indices=_.intersection(result_indices,list_indices)}}return result_indices};window.obp.browse.highlight_items=function(){var items=[];var lists=window.obp.browse.model.browse_lists;for(var i=0;i<lists.length;i++){var checked_items=lists[i]["terms"]||[];for(var j=0;j<checked_items.length;j++){items.push("[data-ed-ref='"+checked_items[j]+"']")}}return{element:items}}})();(function(){"use strict";window.obp.filter.sources=[];window.obp.filter.filter_mode_union="obp-filter-union";window.obp.filter.filter_mode_intersection="obp-filter-intersection";window.obp.filter.filter_mode_default=window.obp.filter.filter_mode_intersection;window.obp.filter.init=function(sources){this.sources=sources;window.obp.event["target"].on(obp.event["events"]["obp:filter-change"],function(){window.obp.filter.filter_entries()})};window.obp.filter.all_filter_indices=function(){var all_indices=[];for(var i=0;i<obp.bibliographies.count;i++){all_indices.push(i)}return all_indices};window.obp.filter.filter_entries=function(){var obp=window.obp,i=0,j=0,result_indices=[],all_indices=[];$("#bibliographies").append(obp.storage.retrieve_all());window.obp.event["target"].trigger(obp.event["events"]["obp:filter-start"]);all_indices=this.all_filter_indices();result_indices=all_indices;for(i=0;i<this.sources.length;i++){var current_indices=this.sources[i].filter_indices();result_indices=_.intersection(result_indices,current_indices)}var storage_prefix=window.obp.storage.key_div;var store_indices=_.difference(all_indices,result_indices);var store={};for(i=0;i<store_indices.length;i++){var $div=$('div[data-src-index="'+store_indices[i]+'"]');if($div.length>0)store[storage_prefix+i]=$div.remove()[0]}window.obp.storage.store(store);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-complete"])}})();(function(){"use strict";window.obp.highlight.init=function(sources){this.sources=sources;window.obp.event["target"].on(obp.event["events"]["obp:filter-complete"],function(){window.obp.highlight.highlight_filter_items()});window.obp.event["target"].on(obp.event["events"]["obp:filter-start"],function(){window.obp.highlight.unhighlight_filter_items()})};window.obp.highlight.match_attr_name="data-match";window.obp.highlight.match_class="obp-match";window.obp.highlight.match_attr_preproc=function(str){return str.toUpperCase().trim()};window.obp.highlight.highlight_filter_items=function(){var i;var items={element:[],term:[]};for(var i=0;i<this.sources.length;i++){var result=this.sources[i].highlight_items();for(var k in result){items[k]=items[k].concat(result[k])}}for(i=0;i<items["element"].length;i++){this.highlight_elt(items["element"][i])}for(i=0;i<items["term"].length;i++){this.highlight_term(items["term"][i])}};window.obp.highlight.highlight_elt=function(selector){$(selector).map(function(i,elt){var $elt=$(elt);var span=document.createElement("span");span.appendChild(document.createTextNode($elt.text()));$(span).addClass(window.obp.highlight.match_class);$elt.text("");$elt.append(span)})};window.obp.highlight.highlight_term=function(term){var highlighter=window.obp.highlight;var re=new RegExp("\\b"+term+"\\b","i");$("#bibliographies").find("*").contents().filter(function(){return this.nodeType===3&&this.textContent.match(re)}).map(function(){var match;while(match=re.exec(this.textContent)){var span=document.createElement("span");span.appendChild(document.createTextNode(match[0]));span.setAttribute("class",highlighter.match_class);span.setAttribute(highlighter.match_attr_name,highlighter.match_attr_preproc(term));var node_after=this.splitText(match.index);node_after.textContent=node_after.textContent.substr(match[0].length);this.parentNode.insertBefore(this,node_after);this.parentNode.insertBefore(span,node_after)}})};window.obp.highlight.unhighlight_filter_items=function(){var highlight=window.obp.highlight;$("#bibliographies").find("."+highlight.match_class).map(function(){var text=this.textContent||this.innerText;var text_node=document.createTextNode(text);this.parentNode.replaceChild(text_node,this)})}})();(function(){"use strict";function Openbibl(){}Openbibl.prototype.config={template_dir:"../../js/templates"};Openbibl.prototype.debug=false;Openbibl.prototype.console=typeof console=="object"?console:{};Openbibl.prototype.bibliographies={count:0};Openbibl.prototype.event={target:null,events:{"obp:filter-start":"obp:filter-start","obp:filter-change":"obp:filter-change","obp:filter-mode-change":"obp:filter-mode-change","obp:filter-complete":"obp:filter-complete","obp:bibliography-added":"obp:bibliography-added","obp:search-term-change":"obp:search-term-change","obp:browse-term-change":"obp:browse-term-change"}};Openbibl.prototype.onDocumentReady=function(){this.event.target=$(document.getElementsByTagName("body")[0]);this.filter.init([this.search,this.browse]);this.highlight.init([this.search,this.browse]);this.search.init();this.browse.init();this.sort.init();this.change_theme(this.retrieve_cookie("theme-stylesheet"));var browse_data_file="query.json";var search_file=document.location.href.replace(/[^\/]+$/,"")+browse_data_file;this.query.init(search_file,[this.search,this.browse]);$(".obp-sort-anchor").on("click",function(e){window.obp.sort.sort_entries(e.target.getAttribute("data-sort-key"))});$(".obp-filter-mode").change(function(event){window.obp.search.filter_mode_change(event);window.obp.browse.filter_mode_change(event);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"])});window.obp.event["target"].on(obp.event["events"]["obp:bibliography-added"],function(){$('[data-toggle="tooltip"]').tooltip({placement:"top",trigger:"hover"})});window.obp.event["target"].on(obp.event["events"]["obp:filter-complete"],function(){$('[data-toggle="tooltip"]').tooltip({placement:"top",trigger:"hover"})});$(window).resize(function(){window.obp.event["target"].trigger(obp.event["events"]["obp:filter-mode-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:search-term-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:browse-term-change"])})};Openbibl.prototype.browse={};Openbibl.prototype.filter={};Openbibl.prototype.highlight={};Openbibl.prototype.query={};Openbibl.prototype.SaxonCE={};Openbibl.prototype.search={};Openbibl.prototype.sort={};Openbibl.prototype.storage={};Openbibl.prototype.typeahead={};window.obp=new Openbibl;$(document).ready(function(){window.obp.onDocumentReady()})})();(function(){"use strict";window.obp.browse.init=function(){$(".obp-browse-checkbox").click(function(event){var $list=$(event.target).closest(".obp-browse-list");var item={term:event.target.getAttribute("data-browse-item"),list:$list.attr("data-ed-list"),mode:$list.find(".obp-filter-mode:checked").val()};if(event.target.checked===true){window.obp.browse.model.add_term(item)}else{window.obp.browse.model.remove_term(item)}});$(".obp-browse-clear").click(function(event){var $list=$(event.target).closest(".obp-browse-list");var list_type=$list.attr("data-ed-list");var list_mode=$list.find(".obp-filter-mode:checked").val();window.obp.browse.model.remove_term({list:list_type,mode:list_mode});$list.find(".obp-browse-checkbox:checked").each(function(i,elt){elt.checked=false});event.preventDefault()});window.obp.event["target"].on(obp.event["events"]["obp:browse-term-change"],function(){window.obp.browse.view.browse_term_change()})};window.obp.browse.filter_indices=function(){return this.model.filter_indices()};window.obp.browse.highlight_items=function(){return this.model.highlight_items()};window.obp.browse.handle_query_data=function(data){this.model.handle_query_data(data)};window.obp.browse.filter_mode_change=function(event){window.obp.browse.model.filter_mode_change(event)};window.obp.browse.view={};window.obp.browse.view.browse_term_change=function(){var browse=window.obp.browse;$(".obp-browse-checkbox").map(function(i,elt){elt.checked=false});for(var i=0;i<browse.model.browse_lists.length;i++){var list=browse.model.browse_lists[i]["list"];var terms=browse.model.browse_lists[i]["terms"]||[];for(var j=0;j<terms.length;j++){$('.obp-browse-checkbox[data-browse-item="'+terms[j]+'"]').each(function(i,elt){elt.checked=true})}}};window.obp.browse.model={};window.obp.browse.model.browse_data=null;window.obp.browse.model.browse_lists=[];window.obp.browse.model.handle_query_data=function(data){window.obp.browse.model.browse_data=data["browse"]};window.obp.browse.model.filter_mode_change=function(event){var model=this;var $this=$(event.target);var list_type=$this.closest(".obp-browse-list").attr("data-ed-list");if(list_type!==undefined){var browse_mode=$this.val();for(var i=0;i<model.browse_lists.length;i++){if(model.browse_lists[i]["list"]===list_type){model.browse_lists[i]["mode"]=browse_mode}}}};window.obp.browse.model.add_term=function(item){var list=item["list"];var term=item["term"];var browse_obj;for(var i=0;i<this.browse_lists.length;i++){if(this.browse_lists[i]["list"]===list){browse_obj=this.browse_lists.splice(i,1)[0];break}}if(browse_obj===undefined){browse_obj={terms:[],list:list}}var current_terms=browse_obj["terms"]||[];if(_.indexOf(current_terms,term)!==-1)return;current_terms.push(term);browse_obj["terms"]=current_terms;browse_obj["mode"]=$('.obp-browse-list[data-ed-list="'+list+'"]').find(".obp-filter-mode:checked").val();this.browse_lists.push(browse_obj);window.obp.event["target"].trigger(obp.event["events"]["obp:browse-term-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"])};window.obp.browse.model.remove_term=function(item){var list=item["list"];var term=item["term"];var mode=item["mode"];var browse_obj;for(var i=0;i<this.browse_lists.length;i++){if(this.browse_lists[i]["list"]===list){browse_obj=this.browse_lists.splice(i,1)[0];break}}if(browse_obj===undefined||term===undefined){browse_obj={terms:[],list:list,mode:mode}}if(term!==undefined){var current_terms=browse_obj["terms"]||[];browse_obj["terms"]=_.difference(_.toArray(current_terms),term);browse_obj["mode"]=mode}this.browse_lists.push(browse_obj);window.obp.event["target"].trigger(obp.event["events"]["obp:browse-term-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"])};window.obp.browse.model.filter_indices=function(){var filter=window.obp.filter;var result_indices=filter.all_filter_indices();var browse_data=this.browse_data;for(var i=0;i<this.browse_lists.length;i++){var list_type=this.browse_lists[i]["list"];var mode=this.browse_lists[i]["mode"];var checked_items=this.browse_lists[i]["terms"];var list_indices;if(checked_items.length>0){for(var i=0;i<checked_items.length;i++){var item_id=checked_items[i];var item_indices=browse_data[list_type][item_id];list_indices=list_indices||item_indices;if(mode===filter.filter_mode_union){list_indices=_.union(list_indices,item_indices)}else{list_indices=_.intersection(list_indices,item_indices)}}list_indices=list_indices||[];result_indices=_.intersection(result_indices,list_indices)}}return result_indices};window.obp.browse.highlight_items=function(){var items=[];var lists=window.obp.browse.model.browse_lists;for(var i=0;i<lists.length;i++){var checked_items=lists[i]["terms"]||[];for(var j=0;j<checked_items.length;j++){items.push("[data-ed-ref='"+checked_items[j]+"']")}}return{element:items}}})();(function(){"use strict";window.obp.filter.sources=[];window.obp.filter.filter_mode_union="obp-filter-union";window.obp.filter.filter_mode_intersection="obp-filter-intersection";window.obp.filter.filter_mode_default=window.obp.filter.filter_mode_intersection;window.obp.filter.init=function(sources){this.sources=sources;window.obp.event["target"].on(obp.event["events"]["obp:filter-change"],function(){window.obp.filter.filter_entries()})};window.obp.filter.all_filter_indices=function(){var all_indices=[];for(var i=0;i<obp.bibliographies.count;i++){all_indices.push(i)}return all_indices};window.obp.filter.filter_entries=function(){var obp=window.obp,i=0,j=0,result_indices=[],all_indices=[];$("#bibliographies").append(obp.storage.retrieve_all());window.obp.event["target"].trigger(obp.event["events"]["obp:filter-start"]);all_indices=this.all_filter_indices();result_indices=all_indices;for(i=0;i<this.sources.length;i++){var current_indices=this.sources[i].filter_indices();result_indices=_.intersection(result_indices,current_indices)}var storage_prefix=window.obp.storage.key_div;var store_indices=_.difference(all_indices,result_indices);var store={};for(i=0;i<store_indices.length;i++){var $div=$('div[data-src-index="'+store_indices[i]+'"]');if($div.length>0)store[storage_prefix+i]=$div.remove()[0]}window.obp.storage.store(store);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-complete"])}})();(function(){"use strict";window.obp.highlight.init=function(sources){this.sources=sources;window.obp.event["target"].on(obp.event["events"]["obp:filter-complete"],function(){window.obp.highlight.highlight_filter_items()});window.obp.event["target"].on(obp.event["events"]["obp:filter-start"],function(){window.obp.highlight.unhighlight_filter_items()})};window.obp.highlight.match_attr_name="data-match";window.obp.highlight.match_class="obp-match";window.obp.highlight.match_attr_preproc=function(str){return str.toUpperCase().trim()};window.obp.highlight.highlight_filter_items=function(){var i;var items={element:[],term:[]};for(var i=0;i<this.sources.length;i++){var result=this.sources[i].highlight_items();for(var k in result){items[k]=items[k].concat(result[k])}}for(i=0;i<items["element"].length;i++){this.highlight_elt(items["element"][i])}for(i=0;i<items["term"].length;i++){this.highlight_term(items["term"][i])}};window.obp.highlight.highlight_elt=function(selector){$(selector).map(function(i,elt){var $elt=$(elt);var span=document.createElement("span");span.appendChild(document.createTextNode($elt.text()));$(span).addClass(window.obp.highlight.match_class);$elt.text("");$elt.append(span)})};window.obp.highlight.highlight_term=function(term){var highlighter=window.obp.highlight;var re=new RegExp("\\b"+term+"\\b","i");$("#bibliographies").find("*").contents().filter(function(){return this.nodeType===3&&this.textContent.match(re)}).map(function(){var match;while(match=re.exec(this.textContent)){var span=document.createElement("span");span.appendChild(document.createTextNode(match[0]));span.setAttribute("class",highlighter.match_class);span.setAttribute(highlighter.match_attr_name,highlighter.match_attr_preproc(term));var node_after=this.splitText(match.index);node_after.textContent=node_after.textContent.substr(match[0].length);this.parentNode.insertBefore(this,node_after);this.parentNode.insertBefore(span,node_after)}})};window.obp.highlight.unhighlight_filter_items=function(){var highlight=window.obp.highlight;$("#bibliographies").find("."+highlight.match_class).map(function(){var text=this.textContent||this.innerText;var text_node=document.createTextNode(text);this.parentNode.replaceChild(text_node,this)})}})();(function(){"use strict";window.obp.query.subscribers=[];window.obp.query.init=function(file,subscribers){var obp_query=this;this.subscribers=subscribers;$.ajax({url:file,async:true,type:"GET",dataType:"json",success:obp_query.handle_query_success,error:function(jqXHR,textStatus,errorThrown){window.obp.console.log("Query data ajax error: "+textStatus)}})};window.obp.query.handle_query_success=function(data){var subscribers=window.obp.query.subscribers;for(var i=0;i<subscribers.length;i++){subscribers[i].handle_query_data(data)}}})();(function(){"use strict";window.obp.SaxonCE.Saxon=null;window.obp.SaxonCE.onSaxonLoad=function(Saxon,xsl_url,xml_url,parameters){this.Saxon=Saxon;if(this.debug)this.Saxon.setLogLevel("FINE");this.requestTransform(xsl_url,xml_url,parameters,this.SaxonSuccessHandler)};window.obp.SaxonCE.requestTransform=function(xsl_url,xml_url,parameters,handler){var errors=[];var xsl=this.SaxonRequestXMLHandler(xsl_url,errors);var xml=this.SaxonRequestXMLHandler(xml_url,errors);if(errors.length>0){if(this.debug)this.console.log("Failed to load XML resource(s): "+errors.toString());return}var proc=Saxon.newXSLT20Processor(xsl);for(var key in parameters)proc.setParameter(key,parameters[key]);proc.setSuccess(handler);this.Saxon.setErrorHandler(this.SaxonErrorHandler);proc.transformToDocument(xml)};window.obp.SaxonCE.SaxonRequestXMLHandler=function(url,errors){var xml;try{xml=this.Saxon.requestXML(url)}catch(e){if(this.debug)this.console.log("Error requesting XML resource: "+e.toString());errors.push("Failed to load resource '"+url+"'")}return xml};window.obp.SaxonCE.SaxonErrorHandler=function(saxonError){var obp=window.obp;if(obp.debug){obp.console.log("SaxonErrorHandler ("+saxonError.level+"): "+saxonError.message)}};window.obp.SaxonCE.SaxonGetResultWrapper=function(data){var result_wrapper=null;try{result_wrapper=data.getResultDocument().querySelector("#result")}catch(e){if(this.debug)this.console.log("Failed to called querySelector() in Saxon on-success callback: "+e.toString())}if(result_wrapper===null){try{result_wrapper=data.getResultDocument().documentElement}catch(e){if(this.debug)this.console.log("Failed to get document element in Saxon on-success callback")}}return result_wrapper};window.obp.SaxonCE.SaxonSuccessHandler=function(data){var obp=window.obp;var result_wrapper=obp.SaxonCE.SaxonGetResultWrapper(data);if(result_wrapper===null){return}var children=result_wrapper.getElementsByTagName("div");var bibliographies_wrapper=document.getElementById("bibliographies");for(var i=0;i<children.length;i++){bibliographies_wrapper.appendChild(children[i].cloneNode(true))}obp.bibliographies.count=children.length;window.obp.event["target"].trigger(window.obp.event["events"]["obp:bibliography-added"])}})();(function(){"use strict";window.obp.search.typeahead_list_len=20;window.obp.search.init=function(){this.view.init();$(".obp-search-panel").bind("shown.bs.collapse",function(){$(this).find(".obp-search-panel-input").focus()});$(".obp-search-form").on("submit",function(event){event.preventDefault()});$(".obp-search-clear").click(function(event){var search_terms=$(event.target.parentElement.parentElement).find("a.obp-search-item").map(function(elt){return this.getAttribute("data-selection")});window.obp.search.model.remove_terms(search_terms);event.preventDefault()})};window.obp.search.term_list_item_class="obp-search-item";window.obp.search.filter_indices=function(){return this.model.filter_indices()};window.obp.search.highlight_items=function(){return this.model.highlight_items()};window.obp.search.handle_query_data=function(data){this.model.handle_query_data(data)};window.obp.search.remove_terms=function(terms){window.obp.search.model.remove_terms(terms)};window.obp.search.filter_mode_change=function(event){window.obp.search.model.filter_mode_change(event)};window.obp.search.view={};window.obp.search.view.init=function(){var search=window.obp.search;this.retrieve_templates();$(".search-input").typeahead({items:search.typeahead_list_len,matcher:search.view.matcher,source:search.view.source,updater:search.view.updater});window.obp.event["target"].on(obp.event["events"]["obp:search-term-change"],function(){window.obp.search.view.search_change()})};window.obp.search.view.compiled_templates={"search.term-li.handlebars":null};window.obp.search.view.retrieve_templates=function(){var view=this;var templates=Object.keys(view.compiled_templates);for(var i=0;i<templates.length;i++){view.retrieve_template(templates[i])}};window.obp.search.view.retrieve_template=function(template){var view=this;var path=window.obp.config["template_dir"]+"/"+template;$.ajax({url:path,cache:true,success:function(data){view.compiled_templates[template]=Handlebars.compile(data)},error:function(jqXHR,textStatus,errorThrown){if(window.obp.debug){window.obp.console.log("Seach-template AJAX error for template '"+template+"': "+textStatus)}}})};window.obp.search.view.search_change=function(){var search=window.obp.search;var active_search_terms=search.model.active_search_terms;$("."+search.term_list_item_class).parent().remove();var li=[];for(var i=0;i<search.model.active_search_terms.length;i++){var new_li=search.view.compiled_templates["search.term-li.handlebars"]({cls:search.term_list_item_class,term:active_search_terms[i]});li.push(new_li)}if(li.length>0){$(".obp-search-results-list").each(function(i,elt){var $ul=$(elt);$ul.append(li)});$("."+search.term_list_item_class).click(function(e){var term=e.target.parentElement.getAttribute("data-selection");if(term)search.model.remove_terms([term])})}};window.obp.search.view.source=function(){var search=window.obp.search;return _.without(Object.keys(search.model.document_data),search.model.active_search_terms)};window.obp.search.view.matcher=function(item){return new RegExp("^"+this.query,"i").test(item)};window.obp.search.view.updater=function(selection){var obp=window.obp;$(".typeahead").val("");obp.search.model.add_term(selection)};window.obp.search.model={};window.obp.search.model.filter_mode_change=function(event){var model=this;model.current_search_mode=$($(".obp-search-panel")[0]).find(".obp-filter-mode:checked").val()};window.obp.search.model.document_data={};window.obp.search.model.active_search_terms=[];window.obp.search.model.current_search_mode=window.obp.filter.filter_mode_default;window.obp.search.model.to_key=function(item){return String(item).toUpperCase()};window.obp.search.model.handle_query_data=function(data){var search=window.obp.search;var i,j;var termmap={};var len=data["search"].length;var search_data=data["search"];for(i=0;i<len;i+=2){for(j=0;j<search_data[i].length;j++){termmap[search_data[i][j]]=search_data[i+1]}}search.model.document_data=termmap};window.obp.search.model.add_term=function(term){var current_terms=this.active_search_terms||[];if(_.indexOf(current_terms,term)!==-1)return;current_terms.push(term);this.active_search_terms=current_terms;window.obp.event["target"].trigger(obp.event["events"]["obp:search-term-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"])};window.obp.search.model.remove_terms=function(remove_terms){var current_terms=this.active_search_terms||[];var new_terms=_.difference(_.toArray(current_terms),_.toArray(remove_terms));if(new_terms.length===current_terms.length)return;this.active_search_terms=new_terms;window.obp.event["target"].trigger(obp.event["events"]["obp:search-term-change"]);window.obp.event["target"].trigger(obp.event["events"]["obp:filter-change"])};window.obp.search.model.filter_indices=function(){var filter=window.obp.filter;var search_data=this.document_data;var result_indices=window.obp.filter.all_filter_indices();var mode=this.current_search_mode;var terms=this.active_search_terms;if(terms.length>0){var list_indices;for(var i=0;i<terms.length;i++){var item_indices=search_data[terms[i]];list_indices=list_indices||item_indices;if(mode===filter.filter_mode_union){list_indices=_.union(list_indices,item_indices)}else{list_indices=_.intersection(list_indices,item_indices)}}result_indices=_.intersection(result_indices,list_indices)}return result_indices};window.obp.search.model.highlight_items=function(){return{term:this.active_search_terms}}})();(function(){"use strict";window.obp.sort.init=function(){window.obp.event["target"].on(obp.event["events"]["obp:filter-complete"],function(){window.obp.sort.sort_entries(window.obp.sort.current_sort_key)})};window.obp.sort.sort_key_default="data-src-index";window.obp.sort.current_sort_key=null;window.obp.sort.sort_entries=function(key){if(key===undefined||key===null){key=this.sort_key_default}this.current_sort_key=key;var $wrapper=$("#bibliographies");var $entries=$wrapper.children("div.entry").remove();$entries.sort(function(a,b){return a.getAttribute(key).localeCompare(b.getAttribute(key))});$wrapper.append($entries);window.obp.event["target"].trigger(obp.event["events"]["obp:bibliography-added"])}})();(function(){"use strict";window.obp.storage.cache={};window.obp.storage.retrieve=function(keys){var ret=[];for(var i=0;i<keys.length;i++){ret.push(this.cache[keys[i]]);delete this.cache[keys[i]]}return ret};window.obp.storage.retrieve_all=function(){var ret=[];for(var key in this.cache){ret.push(this.cache[key]);delete this.cache[key]}return ret};window.obp.storage.store=function(obj){for(var key in obj)this.cache[key]=obj[key]};window.obp.storage.key_div="div-entry-"})();(function(){"use strict";window.obp.change_theme=function(stylesheet){if(stylesheet===undefined)return;var $theme_css=$("#theme-css");this.update_cookie("theme-stylesheet",stylesheet);var parts=$theme_css.attr("href").split("/");parts[parts.length-1]=stylesheet;stylesheet=parts.join("/");if($theme_css.attr("href")!==stylesheet)$("#theme-css").attr("href",stylesheet)}})();(function(){"use strict";window.obp.typeahead.terms=null;window.obp.typeahead.data={};window.obp.typeahead.to_key=function(item){return String(item).toUpperCase()};window.obp.typeahead.load=function(){var obp_t=this;var typeahead_file=document.location.href.replace(/[^\/]+$/,"")+"typeahead.json";var typeahead_list_len=20;$.ajax({url:typeahead_file,async:true,type:"GET",dataType:"json",success:function(data){var i,j;var termmap={};for(i=0;i<data.length;i+=2){for(j=0;j<data[i].length;j++){termmap[data[i][j]]=data[i+1]}}obp_t.data=termmap;$(".search-input").typeahead({items:typeahead_list_len,matcher:function(item){return new RegExp("^"+this.query,"i").test(item)},source:obp_t.source,updater:obp_t.updater})},error:function(jqXHR,textStatus,errorThrown){obp.console.log("Typeahead ajax error: "+textStatus)}})};window.obp.typeahead.source=function(){var obp_t=window.obp.typeahead;var applied={};$.map($(document.getElementById("search-results-list")).find("a"),function(n,i){applied[obp_t.to_key(n.getAttribute("data-selection"))]=true});return $.grep(Object.keys(obp_t.data),function(n,i){return!applied[obp_t.to_key(n)]})};window.obp.typeahead.updater=function(selection){var obp=window.obp;if(obp.debug)obp.console.log("Adding filter item: "+selection);$(".typeahead").val("");obp.filter.add_filter_item(selection)}})();(function(){"use strict";window.obp.scroll_to_id=function(ref_id,dlg_id){var $dlg=$("#"+dlg_id);$dlg.on("hidden.bs.modal",function(e){var $elt=$("#"+ref_id);if($elt.length==0)return;$("html body").scrollTop($elt.offset().top-$("#bibliographies").offset().top);$elt.css("background-color","red").delay(1e4).removeClass("obp-highlight")});$dlg.modal("hide")};window.obp.retrieve_cookie=function(key){return $.cookie(key)};window.obp.update_cookie=function(key,val){if(key!==undefined)$.cookie(key,val)}})();